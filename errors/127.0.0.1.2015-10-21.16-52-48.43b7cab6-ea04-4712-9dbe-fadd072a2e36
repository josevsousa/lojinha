(dp1
S'output'
p2
S"<type 'exceptions.AttributeError'> 'NoneType' object has no attribute 'split'"
p3
sS'layer'
p4
S'/home/python/web2pyLojinha/applications/lojinha/controllers/caixa.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\n\n@auth.requires_login()\ndef cliente():\n\t#existe sess\xc3\xa3o aberta?\n\tif not session.venda.codigo: #n\xc3\xa3o\n\t\tuserDiv = UL(LI(STRONG(\'Nome : \'),SPAN(\'\'),_class="list-group-item"),LI(STRONG(\'Celular : \'),SPAN(\'\'),_class="list-group-item"),LI(STRONG(\'E-mail :\'),SPAN(\'\'),_class="list-group-item"),_class="list-group")\n\telse: #sim\n\n\t\t#mostra o div com os novos valores\n\t\tuserDiv = UL(\n\t\t\tLI(STRONG(\'Nome: \'),SPAN(session.venda.nome,_id="nn"),_class="list-group-item"),\n\t\t\tLI(STRONG(\'Celular : \'),SPAN(session.venda.celular),_class="list-group-item"),\n\t\t\tLI(STRONG(\'E-mail : \'),SPAN(session.venda.email),_class="list-group-item"),_class="list-group")\t\n\treturn dict(userDiv=userDiv,codigo=session.venda.codigo)\n\n@auth.requires_login()\ndef clientes_retorno():\n    pattern = \'%\' + request.vars.itens + \'%\' #primeira letra maiusculo\n    selecionado = [row for row in db(db.clientes.nome.like(pattern)).select()] #select no db\n\t#se a session nao existir criar ela\n\n    if not session.venda.codigo:\n\t\tfrom random import*\n\t\tsession.venda.codigo = randint(1000,10000000) \n\t\n\t\t# response.flash = "Codigo da venda : %s"%session.vendaAtual_codigo  \n\n    for s in selecionado:\n    \tsession.venda.nome = s.nome\n    \tsession.venda.celular = s.celular\n    \tsession.venda.email = s.email\n\t\n\t# userDiv = UL(\n\t# \tLI(STRONG(\'Nome : \'),SPAN(session.vendaAtual_nome,_id="nn"),_class="list-group-item"),\n\t# \tLI(STRONG(\'Celular : \'),SPAN(session.vendaAtual_celuar),_class="list-group-item"),\n\t# \tLI(STRONG(\'E-mail : \'),SPAN(session.vendaAtual_email),_class="list-group-item"),_class="list-group")\n\n    return dict()\n\n@auth.requires_login()\ndef produto():\n\treturn dict(tb=session.venda.itens)\n\n@auth.requires_login()\ndef caixa():\t\n\tlistaCompras = session.venda.itens \n\treturn dict(l=listaCompras)\n\n@auth.requires_login()\ndef addProdutoAjax():\n\t\n\tif not session.venda.sTotal:\n\t    session.venda.total = 0 \n\n\tcodigo = request.vars.codigo\n\tproduto = request.vars.produto\n\tqtde = request.vars.qtde\n\n\n\t#buscar valor do item\n\tvalorItem = db(db.produtos.codigo_produto == codigo).select("preco_produto_lojinha")[0]._extra[\'preco_produto_lojinha\']\n\t\n  \tvalorTotal = int(qtde)*float(valorItem)\n  \tsession.venda.sTotal = float(session.venda.sTotal)+float(valorTotal)\n\t# soma valorItem com a qtde\n\n\t\t\n\titensVendaTable = session.venda.itens                              \n\titensVendaTable.insert(0, TR(TD(codigo),TD(qtde),TD(produto),TD("R$ %.2f"%valorItem),TD("R$ %.2f"%valorTotal),TD(A(SPAN(_class="glyphicon glyphicon-remove"), _class="btn btn-default fechar Jview btn-xs", _href="#"),_class="btD")))\n\tsession.venda.itens = itensVendaTable\n\n\treturn dict()\n\n@auth.requires_login()\ndef delItemProduto():\n    index = request.vars.delIndex\n    index = index.split(";")\n    session.venda.itens.__delitem__(int(index[0]))\n    session.venda.sTotal = float(session.venda.sTotal) - float(index[1]) #subtra\xc3\xa7\xc3\xa3o do valor dos itens\n\n    return dict()\n\n@auth.requires_login()\ndef fecharVenda():\n\tindex = request.vars.transitory\n\tindex = index.split(";")\n\n\t# dados a gravar no db\n\tcodigoVenda = session.venda.codigo\n\tclienteEmail = session.venda.email\n\ttipoVenda = index[0]\n\tvalorVenda = index[1]\n\tvalorDesconto = index[2]\n\tvendedor = session.auth.user.email\n\titensVenda = session.venda.itens\n\n\tif valorDesconto == \'\':\n\t\tvalorDesconto = \'0.00\'\n\t\tpass\n\n\t#---- GUARDAR VENDA NO DB\n\tdb.historicoVendas.insert(\n\t\tcodigoVenda = codigoVenda,\n\t\tclienteEmail = clienteEmail,\n\t\ttipoVenda = tipoVenda,\n\t\tvalorVenda = valorVenda,\n\t\tvalorDesconto = valorDesconto,  \n\t\tvendedor = vendedor,\n\t\titensVenda = itensVenda \n\t\t)\n\tdb.commit()\n\t\n\tviewDesc = "";\n\tif valorDesconto != "0.00":\n\t\tvalorT = (float(valorVenda) + float(valorDesconto))\n\t\tviewDesc = "<h3><b>Total</b> : R$ %.2f - <b>Desconto</b> : <span>R$ %.2f</span></h3>"%(valorT, float(valorDesconto))\n\t\t\n\t# comprovante do email para impressao\n\tdiv = XML(\n\t\t\t"<div style=\'text-align:center;display:none\' class=\'logoP\'>"+\n\t\t\t\t"<img src=\'https://dl.dropboxusercontent.com/u/11469395/Nallu.paiva/logoPrint.png\' width=\'95pt\'><hr>" +\n\t\t\t"</div>"+\n\t\t\t"<h3>Recibo de compra Nallubaby ( codigo : %s )</h3><br>"%session.venda.codigo +\t\t\n\t\t"<div id=\'retornoCliente\'>" +\n\t\t\t"<ul class=\'list-group\'>" +\n\t\t\t\t"<li class=\'list-group-item\'><strong>Cliente: </strong><span id=\'nn\'>%s</span></li>"%session.venda.nome +\n\t\t\t\t"<li class=\'list-group-item\'><strong>Celular : </strong><span>%s</span></li>"%session.venda.celular +\n\t\t\t\t"<li class=\'list-group-item\'><strong>E-mail : </strong><span>%s</span></li>"%session.venda.email +\n\t\t\t"</ul> "  +\n\t\t"</div>" +\n\t\t\t"<div class=\'table-responsive\'>"+\n\t\t\t\t"<table class=\'table table-bordered\'>"+\n\t\t\t\t\t"<thead>"+\n\t\t\t\t\t\t"<tr>"+\n\t\t\t\t\t\t\t"<th>C\xc3\xb3digo</th>"+\n\t\t\t\t\t\t\t"<th>Qtde</th>"+\n\t\t\t\t\t\t\t"<th>Produto</th>"+\n\t\t\t\t\t\t\t"<th>Valor Unidade</th>"+\n\t\t\t\t\t\t\t"<th>Valor Total</th>"+\n\t\t\t\t\t\t"</tr>"+\n\t\t\t\t\t"</thead>"+\n\t\t\t\t\t"<tbody id=\'bodyPrint\'>%s</tbody>"%itensVenda +\n\t\t\t\t"</table>"+\n\t\t\t\t"%s"%viewDesc +\n\t\t\t\t"<h3><b>SUB-TOTAL</b> = R$ %.2f  |  <b>Tipo pagamento</b> : %s </h3>"%(float(valorVenda), tipoVenda) + \n\t\t\t"</div>"  +\t\n\t\t\t"<hr>" +\n\t\t\t"<a href=\'cliente?menu=caixa\' class=\'btn btn-default btVolt\'>Voltar</a>" +\n\t\t\t"<a href=\'javascript:window.print()\' class=\'btn btn-info btPrint\'>imprimir</a>" \n\t\t\t# "<nav>" +\n\t\t\t#   "<ul class=\'pager\' style=\'%s\'>"%\'width:100px\' +\n\t\t\t#     "<li class=\'previous\'><a href=\'cliente?menu=caixa\'><span aria-hidden=\'true\'>&larr;</span> voltar</a></li> "+\n\t\t\t#   "</ul>" +\n\t\t\t# "</nav>"\n\t\t)\n\t\n\t# comprovante do email sem html\n\titensNew = itensVenda\n\titensNew = itensNew\n\temailSimples = "|---------------- RECIBO DE COMPRA ----------------|\\n"\\\n\t" ### ESSE DISPOSITIVO NAO E POSSIVEL VISUALIZAR OS DADOS ###\\n"\\\n\t" ### Por gentileza visualize no seu email."\n\n\n\t# comprovante do email com html\n\temailHTML = "<html><body>"\\\n\t\t"<div class=\'gl\'"\\\n\t\t\t"<div style=\'text-align:center\'>"\\\n\t\t\t\t"<img src=\'https://dl.dropboxusercontent.com/u/11469395/Nallu.paiva/logoPrint.png\' width=\'95pt\'><hr>" \\\n\t\t\t"</div>"\\\n\t\t\t"<h3>Recibo de compra Nallubaby ( codigo : %s )</h3>" \\\n\t\t\t"<div>"\\\n\t\t\t\t"<table id=\'myT\' style=\'width:%s\'>"\\\n\t\t\t\t\t"<thead>"\\\n\t\t\t\t\t\t"<tr>"\\\n\t\t\t\t\t\t\t"<th>C\xc3\xb3digo</th>"\\\n\t\t\t\t\t\t\t"<th>Qtde</th>"\\\n\t\t\t\t\t\t\t"<th>Produto</th>"\\\n\t\t\t\t\t\t\t"<th>Valor Unidade</th>"\\\n\t\t\t\t\t\t\t"<th>Valor Total</th>"\\\n\t\t\t\t\t\t"</tr>"\\\n\t\t\t\t\t"</thead>"\\\n\t\t\t\t\t"<tbody>%s</tbody>" \\\n\t\t\t\t"</table>"\\\n\t\t\t\t"%s" \\\n\t\t\t\t"<h3><b>SUB-TOTAL</b> = R$ %.2f  |  <b>Tipo pagamento</b> : %s </h3>" \\\n\t\t\t"</div><hr>" \\\n\t\t\t"<h3>Muito Obrigado pela compra! Volte sempre."\\\n\t\t"</div></body></html>"\\\n\t\t"<style> .btD{display:none} </style>"%(session.venda.codigo,\'100%\',itensVenda,viewDesc,float(valorVenda),tipoVenda)\t\n\t\t\n\n\t#---- ENVIAR COMPROVANTE AO CLIENTE\n\tif mail:\n\t    if mail.send(to=["%s"%session.venda.email],\n\t        subject=\'Recibo de compra Nallubaby Cod:\',\n\t        # message= "Hello this is an email send from minerva.com from contact us form.\\nName:"+ session.name+" \\nEmail : " + session.email +"\\nSubject : "+session.subject +"\\nMessage : "+session.message+ ".\\n "\n\t    \tmessage=[emailSimples, emailHTML]\n\t    ):\n\t        response.flash = \'Recibo enviado por email ao cliente!.\'\n\t    else:\n\t        response.flash = \'Problema ao enviars o email!\'\n\telse:\n\t    response.flash = \'Unable to send the email : email parameters not defined\'\n\t\n\t#---- LIMPAR STORAGE\n\tsession.__delitem__(\'venda\')\n\n\treturn div\t\t\n\t\n@auth.requires_membership(\'admin\')\ndef historico():\n\treturn dict(formListar=db(db.historicoVendas.id>0).select())\n\ndef buscarVenda():\n\t#codigo de busca\n\tbusca = request.vars.transitory\n\tvenda = db(db.historicoVendas.codigoVenda == busca).select()\n\n\n\t# dados pego no db\n\tcodigoVenda = busca\n\ttipoVenda = venda[0].tipoVenda\n\tvalorVenda = venda[0].valorVenda\t\n\tvalorDesconto = venda[0].valorDesconto\n\tvendedor = venda[0].vendedor\n\titensVenda =  venda[0].itensVenda\n\n\t\t\n\tviewDesc = "";\n\tif valorDesconto != "":\n\t\tvalorT = (float(valorVenda) + float(valorDesconto))\n\t\tviewDesc = "<h3><b>Total</b> : R$ %.2f - <b>Desconto</b> : <span>R$ %.2f</span></h3>"%(valorT, float(valorDesconto))\n\n\n\t# comprovante do email para impressao\n\tdiv = XML(\n\t\t"<div class=\'animated fadeIn\'>"\n\t\t\t"<div style=\'text-align:center;display:none\' class=\'logoP\'>"+\n\t\t\t\t"<img src=\'https://dl.dropboxusercontent.com/u/11469395/Nallu.paiva/logoPrint.png\' width=\'95pt\'><hr>" +\n\t\t\t"</div>"+\n\t\t\t"<h3>Recibo de compra Nallubaby ( codigo : %s )</h3><br>"%codigoVenda +\t\t\n\t\t"<div id=\'retornoCliente\'>" +\n\t\t\t"<ul class=\'list-group\'>" +\n\t\t\t\t"<li class=\'list-group-item\'><strong>Cliente: </strong><span id=\'nn\'>Jose</span></li>" +\n\t\t\t\t"<li class=\'list-group-item\'><strong>Celular : </strong><span>(55) 55555-5555</span></li>" +\n\t\t\t\t"<li class=\'list-group-item\'><strong>E-mail : </strong><span>jose@gmail.com</span></li>" +\n\t\t\t"</ul> "  +\n\t\t"</div>" +\n\t\t\t"<div class=\'table-responsive\'>"+\n\t\t\t\t"<table class=\'table table-bordered\'>"+\n\t\t\t\t\t"<thead>"+\n\t\t\t\t\t\t"<tr>"+\n\t\t\t\t\t\t\t"<th>C\xc3\xb3digo</th>"+\n\t\t\t\t\t\t\t"<th>Qtde</th>"+\n\t\t\t\t\t\t\t"<th>Produto</th>"+\n\t\t\t\t\t\t\t"<th>Valor Unidade</th>"+\n\t\t\t\t\t\t\t"<th>Valor Total</th>"+\n\t\t\t\t\t\t"</tr>"+\n\t\t\t\t\t"</thead>"+\n\t\t\t\t\t"<tbody id=\'bodyPrint\'>%s</tbody>"%itensVenda +\n\t\t\t\t"</table>"+\n\t\t\t\t"%s"%viewDesc +\n\t\t\t\t"<h3><b>SUB-TOTAL</b> = R$ %.2f  |  <b>Tipo pagamento</b> : %s </h3>"%(float(valorVenda), tipoVenda) + \n\t\t\t"</div>"  +\t\n\t\t\t"<hr>" +\n\t\t\t"<a href=\'historico?menu=caixa\' class=\'btn btn-default btVolt\'>Voltar</a>" +\n\t\t\t"<a href=\'javascript:window.print()\' class=\'btn btn-info btPrint\'>imprimir</a>" +\n\t\t\t"</div>"\n\t\t\t# "<nav>" +\n\t\t\t#   "<ul class=\'pager\' style=\'%s\'>"%\'width:100px\' +\n\t\t\t#     "<li class=\'previous\'><a href=\'cliente?menu=caixa\'><span aria-hidden=\'true\'>&larr;</span> voltar</a></li> "+\n\t\t\t#   "</ul>" +\n\t\t\t# "</nav>"\n\n\t\t)\n\treturn div\t\n\n\ndef cancelarVenda():\t\n\t#---- LIMPAR STORAGE\n\tsession.__delitem__(\'venda\')\n\treturn \'\'\nresponse._vars=response._caller(delItemProduto)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/python/web2pyLojinha/gluon/restricted.py", line 227, in restricted\n    exec ccode in environment\n  File "/home/python/web2pyLojinha/applications/lojinha/controllers/caixa.py", line 285, in <module>\n  File "/home/python/web2pyLojinha/gluon/globals.py", line 412, in <lambda>\n    self._caller = lambda f: f()\n  File "/home/python/web2pyLojinha/gluon/tools.py", line 3774, in f\n    return action(*a, **b)\n  File "/home/python/web2pyLojinha/applications/lojinha/controllers/caixa.py", line 78, in delItemProduto\n    index = index.split(";")\nAttributeError: \'NoneType\' object has no attribute \'split\'\n'
p11
s.